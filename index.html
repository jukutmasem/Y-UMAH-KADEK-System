<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Aplikasi Kasir</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
   <style>
    /* CSS untuk Tampilan Aplikasi */
    
    :root {
        --primary-color: #3498db;
        --primary-hover: #2980b9;
        --sidebar-bg: #2c3e50;
        --sidebar-text: #ecf0f1;
        --content-bg: #f4f7f9;
        --card-bg: #ffffff;
        --text-color: #34495e;
        --muted-color: #95a5a6;
        --shadow-light: 0 4px 15px rgba(0, 0, 0, 0.05);
        --shadow-medium: 0 6px 20px rgba(0, 0, 0, 0.1);
    }
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background-color: var(--content-bg);
        color: var(--text-color);
    }
    .container {
        display: flex;
        min-height: 100vh;
    }
    .card {
        background-color: var(--card-bg);
        border-radius: 12px;
        box-shadow: var(--shadow-light);
        padding: 25px;
    }
    /* -- Modal (Edit Form & Struk) -- */
    .modal {
        display: none;
        position: fixed;
        z-index: 101;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
        justify-content: center;
        align-items: center;
    }
    .modal-content {
        background-color: var(--card-bg);
        padding: 30px;
        border-radius: 12px;
        width: 90%;
        max-width: 400px;
        box-shadow: var(--shadow-medium);
        position: relative;
    }
    .modal-close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        position: absolute;
        top: 15px;
        right: 25px;
    }
    .modal-close:hover,
    .modal-close:focus {
        color: #e74c3c;
        text-decoration: none;
        cursor: pointer;
    }

    /* -- Halaman Login -- */
    .login-page {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--content-bg);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        z-index: 100;
    }
    .login-card {
        width: 90%;
        max-width: 400px;
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 40px 30px;
        box-shadow: var(--shadow-medium);
        text-align: left;
    }
    .login-card h2 {
        text-align: center;
        margin-top: 0;
        font-size: 2em;
        color: var(--primary-color);
    }
    .login-card .form-group {
        margin-bottom: 20px;
    }
    .login-card .form-group input {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ddd;
        box-sizing: border-box;
    }
    .login-card .form-group input:focus {
        outline: none;
        border-color: var(--primary-color);
    }
    .login-btn {
        width: 100%;
        padding: 15px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.1em;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .login-btn:hover {
        background-color: var(--primary-hover);
    }
    .login-message {
        text-align: center;
        margin-top: 15px;
        color: #e74c3c;
        display: none;
    }

    /* -- Welcome Page -- */
    .welcome-page {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--primary-color);
        color: white;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        z-index: 100;
    }
    .welcome-page h1 {
        font-size: 3em;
        margin-bottom: 10px;
    }
    .welcome-page p {
        font-size: 1.2em;
        margin-bottom: 30px;
    }
    .welcome-page .start-btn {
        padding: 15px 40px;
        background-color: #2ecc71;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .welcome-page .start-btn:hover {
        background-color: #27ae60;
    }
    .welcome-page i {
        font-size: 5em;
        margin-bottom: 20px;
    }

    /* -- Sidebar Navigation -- */
    .sidebar-nav {
        width: 250px;
        background-color: var(--sidebar-bg);
        color: var(--sidebar-text);
        padding: 30px 20px;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
    }
    .app-logo {
        font-size: 1.5em;
        font-weight: 700;
        text-align: center;
        margin-bottom: 40px;
    }
    .app-logo i {
        color: var(--primary-color);
        margin-right: 10px;
    }
    .sidebar-nav nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .sidebar-nav nav li a {
        display: flex;
        align-items: center;
        color: var(--sidebar-text);
        text-decoration: none;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 8px;
        transition: all 0.3s ease;
        position: relative;
    }
    .sidebar-nav nav li a:hover {
        background-color: #34495e;
    }
    .sidebar-nav nav li a.active {
        background-color: var(--primary-color);
        color: #fff;
        box-shadow: var(--shadow-light);
    }
    .sidebar-nav nav li a i {
        font-size: 1.2em;
        width: 30px;
    }

    /* -- Content Area -- */
    .content {
        flex-grow: 1;
        padding: 30px;
        overflow-y: auto;
    }
    .content-header {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e0e0e0;
    }
    .page-title {
        margin: 0;
        font-size: 2.2em;
        font-weight: 700;
    }
    .page-description {
        margin: 5px 0 0;
        color: var(--muted-color);
    }
    .main-layout {
        display: flex;
        gap: 25px;
        height: calc(100vh - 180px);
    }
    .product-selection-area {
        flex: 2;
        overflow-y: auto;
    }
    .cart-summary-area {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    .page {
        display: none;
    }
    .page.active {
        display: block;
    }

    /* -- Products Grid -- */
    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 15px;
    }
    .product-item {
        background-color: #ecf0f1;
        border-radius: 12px;
        padding: 15px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        cursor: pointer;
        transition: all 0.2s ease;
        border: 1px solid #e9ecef;
    }
    .product-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        background-color: #e2e6ea;
    }
    .product-item h4 {
        margin: 5px 0;
        font-size: 1.1em;
        font-weight: 600;
    }
    .product-item span {
        font-size: 0.9em;
        color: var(--muted-color);
    }

    /* -- Cart Sidebar -- */
    .cart-title {
        margin: 0 0 15px 0;
        padding-bottom: 15px;
        border-bottom: 1px solid #e0e0e0;
        font-size: 1.3em;
        font-weight: 600;
    }
    .cart-title i {
        color: var(--primary-color);
        margin-right: 10px;
    }
    .cart {
        flex-grow: 1;
        overflow-y: auto;
        padding-right: 10px;
    }
    .cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f0f2f5;
    }
    .cart-item button {
        background-color: #e74c3c;
        color: white;
        border: none;
        padding: 5px 12px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
        transition: background-color 0.2s;
    }
    .cart-item button:hover {
        background-color: #c0392b;
    }
    .cart-footer {
        margin-top: 25px;
        padding-top: 20px;
        border-top: 2px solid #e0e0e0;
        position: sticky;
        bottom: 0;
        background-color: var(--card-bg);
        z-index: 2;
    }
    .total-summary {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    .total-summary span {
        font-size: 1.2em;
        color: var(--text-color);
        font-weight: 500;
    }
    .total-summary h3 {
        margin: 0;
        font-size: 1.8em;
        color: var(--text-color);
    }
    .checkout-btn {
        width: 100%;
        padding: 18px;
        background-color: #2ecc71;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.3em;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.2s;
    }
    .checkout-btn:hover {
        background-color: #27ae60;
    }
    .checkout-btn i {
        margin-right: 10px;
    }

    /* -- Form & Table Styles -- */
    form {
        background-color: var(--card-bg);
        padding: 25px;
        border-radius: 12px;
        box-shadow: var(--shadow-light);
        margin-bottom: 25px;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-group label {
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 8px;
        display: block;
    }
    .form-group input {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 12px;
        width: 100%;
        box-sizing: border-box;
        font-size: 1em;
        transition: border-color 0.2s;
    }
    .form-group input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
    }
    .btn {
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.2s ease;
        border: none;
        cursor: pointer;
    }
    .btn-primary {
        background-color: var(--primary-color);
        color: white;
    }
    .btn-primary:hover {
        background-color: var(--primary-hover);
    }
    .btn-danger {
        background-color: #e74c3c;
        color: white;
    }
    .btn-danger:hover {
        background-color: #c0392b;
    }
    .btn-warning {
        background-color: #f39c12;
        color: white;
    }
    .btn-warning:hover {
        background-color: #e67e22;
    }
    .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 25px;
        background-color: var(--card-bg);
        border-radius: 12px;
        box-shadow: var(--shadow-light);
        overflow: hidden;
    }
    .data-table th, .data-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #f0f2f5;
    }
    .data-table th {
        background-color: #ecf0f1;
        color: var(--text-color);
        font-weight: 600;
    }
    .data-table tr:last-child td {
        border-bottom: none;
    }
    .data-table tr:nth-child(even) {
        background-color: #fafbfd;
    }
    .action-buttons {
        display: flex;
        gap: 10px;
    }
    .search-container {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
    }
    .search-container input {
        flex-grow: 1;
    }

    /* --- STYLING UNTUK STRUK --- */
    .struk-content {
        font-family: 'Courier New', Courier, monospace;
        padding: 20px;
        text-align: center;
    }
    .struk-header {
        margin-bottom: 20px;
        text-align: center; /* Menambahkan properti ini */
    }
    .struk-logo {
        max-width: 150px; /* Atur ukuran logo sesuai kebutuhan */
        height: auto;
        margin-bottom: 10px;
    }
    .struk-content h2 {
        margin: 0;
    }
    .struk-content p {
        margin: 5px 0;
        font-size: 0.9em;
    }
    .struk-items {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        font-size: 0.9em;
    }
    .struk-items th, .struk-items td {
        padding: 8px 0;
        text-align: left;
        border-bottom: 1px dashed #ccc;
    }
    .struk-items .item-price, .struk-items .item-qty {
        text-align: right;
    }
    .struk-total {
        text-align: right;
        font-size: 1.1em;
        font-weight: bold;
        border-top: 1px solid black;
        padding-top: 10px;
        margin-top: 10px;
    }
    .struk-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        justify-content: center;
    }
    .struk-buttons .btn {
        width: 100%;
        padding: 10px;
    }
    /* print-specific styles */
   @media print {
    /* Sembunyikan semua elemen kecuali modal */
    body > *:not(#struk-modal) {
        display: none !important;
    }
    /* Tampilkan modal struk secara penuh untuk dicetak */
    #struk-modal {
        display: block !important;
        position: static; /* Ganti fixed menjadi static untuk cetak */
        width: 100%;
        height: auto;
        background-color: white;
        padding: 0;
        margin: 0;
    }
    .modal-content {
        box-shadow: none;
        padding: 0;
        width: auto;
        max-width: none;
    }
    /* Sembunyikan elemen yang tidak perlu dicetak di dalam modal */
    .modal-close, .struk-buttons {
        display: none !important;
    }
    .struk-content, .struk-content * {
        font-weight: bold !important;
        color: black !important;
    }
    /* Pastikan warna teks terlihat hitam */
    h3, h4, p, table {
        color: black !important;
    }
}
    /* New styles for payment method modal */
    .payment-summary-total {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.5em;
        font-weight: bold;
        color: #27ae60;
        margin-bottom: 20px;
    }
    .payment-summary-total h3 {
        margin: 0;
    }
    /* New styles for Laba Bersih details */
    .laba-bersih-details {
        margin-top: 15px;
        font-size: 0.9em;
        line-height: 1.5;
        color: var(--muted-color);
    }
    .report-summary {
        text-align: right;
        padding: 15px;
        border-top: 2px solid #ccc;
        font-size: 1.2em;
        font-weight: bold;
        margin-top: 10px;
    }
    .print-header {
        text-align: center;
        margin-bottom: 20px;
        border-bottom: 2px solid #000;
        padding-bottom: 15px;
    }
    .print-header img {
        max-width: 150px;
        height: auto;
        margin-bottom: 10px;
    }
    
</style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<div id="edit-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeEditModal()">&times;</span>
        <h2>Edit Produk</h2>
        <form id="edit-form-produk">
            <input type="hidden" id="edit-produk-id">
            <div class="form-group">
                <label for="edit-nama-produk">Nama Produk</label>
                <input type="text" id="edit-nama-produk" required>
            </div>
            <div class="form-group">
                <label for="edit-harga-produk">Harga</label>
                <input type="number" id="edit-harga-produk" required>
            </div>
            <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
        </form>
    </div>
</div>

<div id="payment-modal" class="modal">
    <div class="modal-content" style="max-width: 450px;">
        <span class="modal-close" onclick="closePaymentModal()">&times;</span>
        <h2>Pembayaran</h2>
        <div class="payment-summary-total">
            <h3>Total:</h3>
            <span id="payment-modal-total">Rp 0</span>
        </div>
        <form id="payment-form">
            <div class="form-group">
                <label for="input-tunai">Tunai</label>
                <input type="number" id="input-tunai" value="0">
            </div>
            <div class="form-group">
                <label for="input-transfer">Transfer</label>
                <input type="number" id="input-transfer" value="0">
            </div>
            <div style="display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 10px;">
                <span>Total Bayar:</span>
                <span id="total-bayar-modal">Rp 0</span>
            </div>
            <div style="display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 20px;">
                <span>Kembalian:</span>
                <span id="kembalian-modal">Rp 0</span>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Bayar</button>
        </form>
    </div>
</div>

<div id="struk-modal" class="modal">
    <div class="modal-content" style="max-width: 350px;">
        <span class="modal-close" onclick="closeStrukModal()">&times;</span>
        <div id="struk-content" class="struk-content">
            <div class="struk-header">
                <img id="struk-logo" src="Tanpa Judul.jpg" class="struk-logo" alt="Logo U'umah Kadek">
                <h2>Y'UMAH KADEK</h2>
                <p>Pandawa Beach Kutuh, Kuta Selatan, Badung-Bali</p>
            </div>
            <p>Tanggal: <span id="struk-tanggal"></span></p>
            <p>Waktu: <span id="struk-waktu"></span></p>
            <p>No. Meja: <span id="struk-nomor-meja"></span></p>
            <hr>
            <table class="struk-items">
                <thead>
                    <tr>
                        <th colspan="2" style="text-align: left;">Item</th>
                        <th class="item-qty">Qty</th>
                        <th class="item-price">Total</th>
                    </tr>
                </thead>
                <tbody id="struk-items-list"></tbody>
            </table>
            <div class="struk-total">
                <p>Total: <span id="struk-total-harga"></span></p>
                <p>Tunai: <span id="struk-bayar-tunai"></span></p>
                <p>Transfer: <span id="struk-bayar-transfer"></span></p>
                <p>Kembalian: <span id="struk-kembalian"></span></p>
            </div>
            <hr>
            <p>Liburan Happy, Laper No Worry!
Thank you for your order!
We hope you like it.
Jangan lupa follow dan tag kami di media sosial</p>
<p>@y'umah kadek</p>
        </div>
        <div class="struk-buttons">
            <button class="btn btn-primary" onclick="shareStruk()">Bagikan Struk</button>
            <button class="btn btn-warning" onclick="cetakStruk()">Cetak Struk</button>
            <button class="btn btn-danger" onclick="closeStrukModal()">Tutup</button>
        </div>
    </div>
</div>

<div class="login-page" id="login-page">
    <div class="login-card">
        <h2><i class="fas fa-lock"></i> Login</h2>
        <form id="login-form">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" required>
            </div>
            <p id="login-message" class="login-message">Username atau password salah!</p>
            <button type="submit" class="login-btn">Masuk</button>
        </form>
    </div>
</div>

<div class="welcome-page" id="welcome-page" style="display: none;">
    <i class="fas fa-cash-register"></i>
    <h1>Selamat Datang di Kasir App!</h1>
    <p>Kelola bisnis Anda dengan mudah dan efisien.</p>
    <button class="start-btn" onclick="startApp()">Mulai Sekarang</button>
</div>

<div class="container" id="main-app" style="display: none;">
    <div class="sidebar-nav">
        <div class="app-logo">
            <i class="fas fa-cash-register"></i> Y,umah kadek
        </div>
        <nav>
            <ul>
                <li><a href="#" id="link-transaksi" class="active"><i class="fas fa-list-alt"></i> <span>Form Transaksi</span></a></li>
                <li><a href="#" id="link-produk"><i class="fas fa-box-open"></i> <span>Manajemen Produk</span></a></li>
                <li><a href="#" id="link-laporan"><i class="fas fa-chart-line"></i> <span>Laporan Keuangan</span></a></li>
                <li><a href="#" id="link-logout"><i class="fas fa-sign-out-alt"></i> <span>Keluar</span></a></li>
            </ul>
        </nav>
    </div>

    <div class="content">
        <div id="page-transaksi" class="page active">
            <header class="content-header">
                <h1 class="page-title">Form Transaksi</h1>
                <p class="page-description">Pilih produk di bawah ini untuk ditambahkan ke keranjang.</p>
            </header>
            <div class="main-layout">
                <div class="product-selection-area card">
                    <div class="form-group">
                        <label for="nomor-meja">Nomor Meja</label>
                        <input type="text" id="nomor-meja" placeholder="Masukkan nomor meja" required>
                    </div>
                    <div class="search-container">
                        <input type="text" id="search-produk-transaksi" placeholder="Cari produk...">
                        <button class="btn btn-primary" onclick="searchProductsTransaksi()">Cari</button>
                    </div>
                    <div class="products-grid" id="products-grid"></div>
                </div>
                <div class="cart-summary-area card">
                    <h3 class="cart-title"><i class="fas fa-shopping-cart"></i> Keranjang Belanja</h3>
                    <div id="cart-info">No. Meja: <span id="cart-nomor-meja"></span></div>
                    <div class="cart" id="cart-list"></div>
                    <div class="cart-footer">
                        <div class="total-summary">
                            <span>Total</span>
                            <h3 id="total-price">Rp 0</h3>
                        </div>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <button class="btn btn-danger" onclick="clearCart()" style="width: 100%;">Kosongkan Keranjang</button>
                        </div>
                        <button class="checkout-btn" onclick="checkout()"><i class="fas fa-money-bill-wave"></i> Bayar</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="page-produk" class="page">
            <header class="content-header">
                <h1 class="page-title">Manajemen Produk</h1>
                <p class="page-description">Kelola daftar produk Anda di sini.</p>
            </header>
            <form id="form-produk" style="display: none;">
                <div class="form-group">
                    <label for="nama-produk">Nama Produk</label>
                    <input type="text" id="nama-produk" required>
                </div>
                <div class="form-group">
                    <label for="harga-produk">Harga</label>
                    <input type="number" id="harga-produk" required>
                </div>
                <button type="submit" class="btn btn-primary">Simpan Produk</button>
            </form>
            <div class="search-container">
                <input type="text" id="search-produk-manajemen" placeholder="Cari produk...">
                <button class="btn btn-primary" onclick="searchProductsManajemen()">Cari</button>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nama Produk</th>
                        <th>Harga</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="produk-list"></tbody>
            </table>
        </div>
        <div id="page-laporan" class="page">
            <header class="content-header">
                <h1 class="page-title">Laporan Keuangan</h1>
                <p class="page-description">Y'umah kadek</p>
            </header>
            <div class="card" style="margin-bottom: 25px;">
                <h3>Ringkasan Keuangan</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                    <h4>Total Pendapatan : <span id="total-pendapatan">Rp 0</span></h4>
                    <h4>Total Biaya : <span id="total-biaya">Rp 0</span></h4>
                </div>
                <hr>
                <div style="display: flex; justify-content: space-between; font-size: 1.5em; font-weight: bold; color: #27ae60;">
                    <span>Laba Bersih</span>
                    <span id="laba-bersih">Rp 0</span>
                </div>
                <div id="laba-bersih-details" class="laba-bersih-details">
                    <p>Tunai : <span id="laba-bersih-tunai">Rp 0</span></p>
                    <p>Transfer : <span id="laba-bersih-transfer">Rp 0</span></p>
                </div>
            </div>
            <form id="form-filter-laporan" style="margin-bottom: 25px;">
                <div style="display: flex; gap: 15px; align-items: flex-end;">
                    <div class="form-group" style="flex: 1;">
                        <label for="tanggal-mulai">Tanggal Mulai</label>
                        <input type="date" id="tanggal-mulai" class="form-control">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="tanggal-selesai">Tanggal Selesai</label>
                        <input type="date" id="tanggal-selesai" class="form-control">
                    </div>
                    <button type="submit" class="btn btn-primary" style="height: 48px;">Tampilkan</button>
                </div>
            </form>
            <div id="printable-area" class="printable-content">
                <div class="card" style="padding: 0;">
                        <div style="padding: 15px;">
                            <h4>Laporan Keuangan</h4>
                        
                    <div class="non-printable">
                        <button class="btn btn-primary" onclick="downloadReportPdf('pendapatan')">Download Pendapatan</button>
                        <button class="btn btn-danger" onclick="downloadReportPdf('biaya')">Download Biaya</button>
                    </div>
                </div>
                <div id="report-content">
                    <div class="card" style="padding: 0; margin-bottom: 25px;">
                        <div style="padding: 15px;">
                            <h4>Pendapatan</h4>
                        </div>
                        <table class="data-table">
    <thead>
        <tr>
            <th>Tanggal</th>
            <th>No. Transaksi</th>
            <th>No. Meja</th>
            <th>Jumlah</th>
            <th>Tunai</th>
            <th>Transfer</th>
            <th id="th-aksi-pendapatan" style="display: none;" class="non-printable">Aksi</th>
            <th class="non-printable">Struk</th> </tr>
    </thead>
    <tbody id="pendapatan-list"></tbody>
</table>
                        <div class="report-summary">
                            Total Pendapatan: <span id="total-pendapatan-cetak">Rp 0</span>
                        </div>
                    </div>
                    <div class="card" style="padding: 0;">
                        <div style="padding: 15px;">
                            <h4>Biaya Operasional</h4>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Deskripsi</th>
                                    <th>Jumlah</th>
                                    <th id="th-aksi-biaya" style="display: none;" class="non-printable">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="biaya-list"></tbody>
                        </table>
                        <div class="report-summary">
                            Total Biaya: <span id="total-biaya-cetak">Rp 0</span>
                        </div>
                    </div>
                </div>
            </div>
            <div style="padding: 15px;">
                            <h4>Tambah Biaya</h4>
                <form id="form-biaya" class="non-printable">
                    <div class="form-group">
                        <label for="deskripsi-biaya">Deskripsi Biaya</label>
                        <input type="text" id="deskripsi-biaya" required>
                    </div>
                    <div class="form-group">
                        <label for="jumlah-biaya">Jumlah Biaya</label>
                        <input type="number" id="jumlah-biaya" required>
                    </div>
                    <button type="submit" class="btn btn-danger">Tambah Biaya</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    // --- Autentikasi dan Logika Halaman Awal ---
    const users = {
        'admin': 'admin123',
        'kasir': 'kasir123'
    };

    const loginPage = document.getElementById('login-page');
    const welcomePage = document.getElementById('welcome-page');
    const mainApp = document.getElementById('main-app');

    document.addEventListener('DOMContentLoaded', () => {
        if (localStorage.getItem('isLoggedIn') && localStorage.getItem('currentUser')) {
            loginPage.style.display = 'none';
            if (localStorage.getItem('visited')) {
                welcomePage.style.display = 'none';
                mainApp.style.display = 'flex';
                renderInitialPage();
            } else {
                welcomePage.style.display = 'flex';
                mainApp.style.display = 'none';
            }
        } else {
            loginPage.style.display = 'flex';
            welcomePage.style.display = 'none';
            mainApp.style.display = 'none';
        }
    });

    document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const usernameInput = document.getElementById('username').value;
        const passwordInput = document.getElementById('password').value;
        const loginMessage = document.getElementById('login-message');

        if (users[usernameInput] === passwordInput) {
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('currentUser', usernameInput);
            loginPage.style.display = 'none';
            if (localStorage.getItem('visited')) {
                mainApp.style.display = 'flex';
                renderInitialPage();
            } else {
                welcomePage.style.display = 'flex';
            }
        } else {
            loginMessage.style.display = 'block';
        }
    });

    document.getElementById('link-logout').addEventListener('click', function(e) {
        e.preventDefault();
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('currentUser');
        window.location.reload();
    });

    function startApp() {
        localStorage.setItem('visited', 'true');
        welcomePage.style.display = 'none';
        mainApp.style.display = 'flex';
        renderInitialPage();
    }

    function renderInitialPage() {
        const currentUser = localStorage.getItem('currentUser');
        const isAdmin = currentUser === 'admin';
        const formProduk = document.getElementById('form-produk');
        if (formProduk) {
            formProduk.style.display = isAdmin ? 'block' : 'none';
        }
        const thAksiPendapatan = document.getElementById('th-aksi-pendapatan');
        const thAksiBiaya = document.getElementById('th-aksi-biaya');
        if (thAksiPendapatan && thAksiBiaya) {
            thAksiPendapatan.style.display = isAdmin ? 'table-cell' : 'none';
            thAksiBiaya.style.display = isAdmin ? 'table-cell' : 'none';
        }
        const activePageId = document.querySelector('.page.active').id;
        if (activePageId === 'page-transaksi') {
            renderProductsGrid();
            renderCart();
        } else if (activePageId === 'page-produk') {
            renderProdukList();
        } else if (activePageId === 'page-laporan') {
            renderLaporan();
        }
    }

    // --- NAVIGASI ANTAR HALAMAN ---
    const navLinks = document.querySelectorAll('.sidebar-nav a');
    const pages = document.querySelectorAll('.page');

    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            if (this.id === 'link-logout') {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('currentUser');
                window.location.reload();
                return;
            }
            navLinks.forEach(item => item.classList.remove('active'));
            pages.forEach(item => item.classList.remove('active'));
            this.classList.add('active');
            const pageId = this.id.replace('link-', 'page-');
            document.getElementById(pageId).classList.add('active');

            if (pageId === 'page-transaksi') {
                renderProductsGrid();
                renderCart();
            } else if (pageId === 'page-produk') {
                renderProdukList();
            } else if (pageId === 'page-laporan') {
                renderLaporan();
            }
        });
    });

    // --- Manajemen Produk ---
    let products = JSON.parse(localStorage.getItem('products')) || [
        { id: 'prod1', name: 'Nasi Goreng', price: 20000, cost: 10000 },
        { id: 'prod2', name: 'Mie Goreng', price: 18000, cost: 9000 },
        { id: 'prod3', name: 'Ayam Bakar', price: 35000, cost: 18000 },
        { id: 'prod4', name: 'Es Teh', price: 8000, cost: 3000 },
        { id: 'prod5', name: 'Es Jeruk', price: 10000, cost: 4000 }
    ];

    function saveProducts() {
        localStorage.setItem('products', JSON.stringify(products));
        renderProductsGrid();
        renderProdukList();
    }

    function renderProdukList(filterQuery = '') {
        const produkList = document.getElementById('produk-list');
        if (!produkList) return;
        produkList.innerHTML = '';
        const filteredProducts = products.filter(p => p.name.toLowerCase().includes(filterQuery.toLowerCase()));

        if (filteredProducts.length === 0) {
            produkList.innerHTML = '<tr><td colspan="4">Tidak ada produk ditemukan.</td></tr>';
            return;
        }

        filteredProducts.forEach(product => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${product.id}</td>
                <td>${product.name}</td>
                <td>Rp ${product.price.toLocaleString('id-ID')}</td>
                <td>
                    <div class="action-buttons">
                        <button class="btn btn-warning" onclick="openEditModal('${product.id}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteProduct('${product.id}')">Hapus</button>
                    </div>
                </td>
            `;
            produkList.appendChild(row);
        });
    }

    document.getElementById('form-produk').addEventListener('submit', function(e) {
        e.preventDefault();
        const namaProduk = document.getElementById('nama-produk').value;
        const hargaProduk = parseInt(document.getElementById('harga-produk').value);
        const newProduct = {
            id: 'prod' + (products.length + 1),
            name: namaProduk,
            price: hargaProduk,
            cost: hargaProduk * 0.5 // Contoh: biaya 50% dari harga jual
        };
        products.push(newProduct);
        saveProducts();
        this.reset();
    });

    function deleteProduct(productId) {
        if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
            products = products.filter(p => p.id !== productId);
            saveProducts();
        }
    }

    function searchProductsManajemen() {
        const query = document.getElementById('search-produk-manajemen').value;
        renderProdukList(query);
    }

    const editModal = document.getElementById('edit-modal');
    function openEditModal(productId) {
        const product = products.find(p => p.id === productId);
        if (product) {
            document.getElementById('edit-produk-id').value = product.id;
            document.getElementById('edit-nama-produk').value = product.name;
            document.getElementById('edit-harga-produk').value = product.price;
            editModal.style.display = 'flex';
        }
    }

    function closeEditModal() {
        editModal.style.display = 'none';
    }

    document.getElementById('edit-form-produk').addEventListener('submit', function(e) {
        e.preventDefault();
        const productId = document.getElementById('edit-produk-id').value;
        const newName = document.getElementById('edit-nama-produk').value;
        const newPrice = parseInt(document.getElementById('edit-harga-produk').value);

        const productIndex = products.findIndex(p => p.id === productId);
        if (productIndex !== -1) {
            products[productIndex].name = newName;
            products[productIndex].price = newPrice;
            saveProducts();
            closeEditModal();
        }
    });

    // --- Transaksi dan Keranjang ---
    let tablesData = JSON.parse(localStorage.getItem('tablesData')) || {};
    let currentTable = '';
    let transactionHistory = JSON.parse(localStorage.getItem('transactionHistory')) || [];

    function saveTransactionHistory() {
        localStorage.setItem('transactionHistory', JSON.stringify(transactionHistory));
    }

    const nomorMejaInput = document.getElementById('nomor-meja');
    if (nomorMejaInput) {
        nomorMejaInput.addEventListener('change', function() {
            const meja = this.value.trim();
            if (meja) {
                currentTable = meja;
                document.getElementById('cart-nomor-meja').textContent = meja;
                if (!tablesData[meja]) {
                    tablesData[meja] = {};
                }
                renderCart();
            } else {
                currentTable = '';
                document.getElementById('cart-nomor-meja').textContent = '';
                renderCart();
            }
        });
    }

    function clearCart() {
        if (!currentTable) {
            alert("Silakan masukkan nomor meja terlebih dahulu.");
            return;
        }
        if (confirm(`Apakah Anda yakin ingin mengosongkan keranjang untuk meja ${currentTable}?`)) {
            tablesData[currentTable] = {};
            localStorage.setItem('tablesData', JSON.stringify(tablesData));
            renderCart();
        }
    }

    function renderProductsGrid(filterQuery = '') {
        const productsGrid = document.getElementById('products-grid');
        productsGrid.innerHTML = '';
        const filteredProducts = products.filter(p => p.name.toLowerCase().includes(filterQuery.toLowerCase()));

        if (filteredProducts.length === 0) {
            productsGrid.innerHTML = '<p style="text-align: center; color: var(--muted-color);">Tidak ada produk ditemukan.</p>';
            return;
        }

        filteredProducts.forEach(product => {
            const item = document.createElement('div');
            item.className = 'product-item';
            item.innerHTML = `
                <h4>${product.name}</h4>
                <span>Rp ${product.price.toLocaleString('id-ID')}</span>
            `;
            item.addEventListener('click', () => addToCart(product.id));
            productsGrid.appendChild(item);
        });
    }

    function searchProductsTransaksi() {
        const query = document.getElementById('search-produk-transaksi').value;
        renderProductsGrid(query);
    }

    function addToCart(productId) {
        if (!currentTable) {
            alert("Silakan masukkan nomor meja terlebih dahulu.");
            return;
        }
        const product = products.find(p => p.id === productId);
        const cart = tablesData[currentTable];

        if (cart[productId]) {
            cart[productId].quantity++;
        } else {
            cart[productId] = { ...product, quantity: 1 };
        }
        localStorage.setItem('tablesData', JSON.stringify(tablesData));
        renderCart();
    }

    function removeFromCart(productId) {
        if (!currentTable) return;
        const cart = tablesData[currentTable];
        if (cart[productId].quantity > 1) {
            cart[productId].quantity--;
        } else {
            delete cart[productId];
        }
        localStorage.setItem('tablesData', JSON.stringify(tablesData));
        renderCart();
    }

    function renderCart() {
        const cartList = document.getElementById('cart-list');
        const totalPriceEl = document.getElementById('total-price');
        cartList.innerHTML = '';
        let total = 0;
        const cart = tablesData[currentTable] || {};

        if (Object.keys(cart).length === 0) {
            cartList.innerHTML = '<p style="text-align: center; color: var(--muted-color); padding: 20px;">Keranjang kosong.</p>';
        } else {
            for (const productId in cart) {
                const item = cart[productId];
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                const listItem = document.createElement('div');
                listItem.className = 'cart-item';
                listItem.innerHTML = `
                    <div>
                        <strong>${item.name}</strong> x${item.quantity}
                        <br>
                        <span>Rp ${(itemTotal).toLocaleString('id-ID')}</span>
                    </div>
                    <button onclick="removeFromCart('${item.id}')">Hapus</button>
                `;
                cartList.appendChild(listItem);
            }
        }
        totalPriceEl.textContent = `Rp ${total.toLocaleString('id-ID')}`;
    }

    // Fungsi Pembayaran
    const paymentModal = document.getElementById('payment-modal');
    const paymentForm = document.getElementById('payment-form');
    const inputTunai = document.getElementById('input-tunai');
    const inputTransfer = document.getElementById('input-transfer');
    const totalBayarModal = document.getElementById('total-bayar-modal');
    const kembalianModal = document.getElementById('kembalian-modal');
    let totalBayar = 0;

    function checkout() {
        if (!currentTable) {
            alert("Silakan masukkan nomor meja terlebih dahulu.");
            return;
        }
        const cart = tablesData[currentTable] || {};
        if (Object.keys(cart).length === 0) {
            alert('Keranjang belanja kosong!');
            return;
        }

        let total = 0;
        for (const productId in cart) {
            total += cart[productId].price * cart[productId].quantity;
        }

        document.getElementById('payment-modal-total').textContent = `Rp ${total.toLocaleString('id-ID')}`;
        totalBayar = total;

        inputTunai.value = totalBayar;
        inputTransfer.value = 0;
        updateKembalian();

        paymentModal.style.display = 'flex';
    }

    function closePaymentModal() {
        paymentModal.style.display = 'none';
    }

    function updateKembalian() {
        let tunai = parseInt(inputTunai.value) || 0;
        let transfer = parseInt(inputTransfer.value) || 0;
        let totalPembayaran = tunai + transfer;
        let kembalian = totalPembayaran - totalBayar;

        totalBayarModal.textContent = `Rp ${totalPembayaran.toLocaleString('id-ID')}`;
        kembalianModal.textContent = `Rp ${kembalian.toLocaleString('id-ID')}`;
    }

    inputTunai.addEventListener('input', updateKembalian);
    inputTransfer.addEventListener('input', updateKembalian);

    // --- Struk dan Cetak ---
    const strukModal = document.getElementById('struk-modal');
    let currentTransaction;

    paymentForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const tunai = parseInt(inputTunai.value) || 0;
        const transfer = parseInt(inputTransfer.value) || 0;
        const totalPembayaran = tunai + transfer;

        const cart = tablesData[currentTable] || {};
        let totalHarga = 0;
        for (const productId in cart) {
            totalHarga += cart[productId].price * cart[productId].quantity;
        }

        const kembalian = totalPembayaran - totalHarga;

        if (totalPembayaran < totalHarga) {
            alert('Jumlah pembayaran kurang dari total harga!');
            return;
        }

        const nomorMeja = currentTable;
        finalizeTransaction(nomorMeja, tunai, transfer, kembalian, totalHarga, cart);
        closePaymentModal();
    });

    function finalizeTransaction(nomorMeja, tunai, transfer, kembalian, totalHarga, cartData) {
        const transactionId = `TRX-${Date.now()}`;
        const transactionDate = new Date().toISOString();
        const items = Object.values(cartData).map(item => ({
            id: item.id,
            name: item.name,
            quantity: item.quantity,
            price: item.price,
            cost: item.cost,
            total: item.price * item.quantity
        }));

        const newTransaction = {
            id: transactionId,
            date: transactionDate,
            nomorMeja: nomorMeja,
            items: items,
            totalHarga: totalHarga,
            tunai: tunai,
            transfer: transfer,
            kembalian: kembalian
        };
        transactionHistory.push(newTransaction);
        saveTransactionHistory();

        currentTransaction = newTransaction;

        showStruk(newTransaction);

        // Reset keranjang untuk meja ini
        delete tablesData[currentTable];
        localStorage.setItem('tablesData', JSON.stringify(tablesData));

        // Reset tampilan keranjang dan input meja
        document.getElementById('nomor-meja').value = '';
        currentTable = '';
        renderCart();
    }

    function showStruk(transaction) {
        currentTransaction = transaction;
        const strukTanggal = document.getElementById('struk-tanggal');
        const strukWaktu = document.getElementById('struk-waktu');
        const strukNomorMeja = document.getElementById('struk-nomor-meja');
        const strukItemsList = document.getElementById('struk-items-list');
        const strukTotalHarga = document.getElementById('struk-total-harga');
        const strukBayarTunai = document.getElementById('struk-bayar-tunai');
        const strukBayarTransfer = document.getElementById('struk-bayar-transfer');
        const strukKembalian = document.getElementById('struk-kembalian');
        
        const date = new Date(transaction.date);
        strukTanggal.textContent = date.toLocaleDateString('id-ID');
        strukWaktu.textContent = date.toLocaleTimeString('id-ID');
        strukNomorMeja.textContent = transaction.nomorMeja;

        strukItemsList.innerHTML = '';
        transaction.items.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td colspan="2" style="text-align: left;">${item.name}</td>
                <td class="item-qty">${item.quantity}</td>
                <td class="item-price">Rp ${(item.price * item.quantity).toLocaleString('id-ID')}</td>
            `;
            strukItemsList.appendChild(row);
        });

        strukTotalHarga.textContent = `Rp ${transaction.totalHarga.toLocaleString('id-ID')}`;
        strukBayarTunai.textContent = `Rp ${transaction.tunai.toLocaleString('id-ID')}`;
        strukBayarTransfer.textContent = `Rp ${transaction.transfer.toLocaleString('id-ID')}`;
        strukKembalian.textContent = `Rp ${transaction.kembalian.toLocaleString('id-ID')}`;

        strukModal.style.display = 'flex';
    }

    function closeStrukModal() {
        strukModal.style.display = 'none';
        renderLaporan();
    }
    
    // Fungsi Bagikan Struk dengan Fallback
     function shareStruk() {
        if (!currentTransaction) {
            alert('Tidak ada struk untuk dibagikan.');
            return;
        }

        const date = new Date(currentTransaction.date);
        const strukTanggal = date.toLocaleDateString('id-ID');
        const strukWaktu = date.toLocaleTimeString('id-ID');
        const strukNomorMeja = currentTransaction.nomorMeja;
        const totalHarga = currentTransaction.totalHarga.toLocaleString('id-ID');
        const bayarTunai = currentTransaction.tunai.toLocaleString('id-ID');
        const bayarTransfer = currentTransaction.transfer.toLocaleString('id-ID');
        const kembalian = currentTransaction.kembalian.toLocaleString('id-ID');

        let textStruk = `
Y'UMAH KADEK
Pandawa Beach Kutuh, Kuta Selatan, Badung-Bali
Tanggal: ${strukTanggal}
Waktu: ${strukWaktu}
No. Meja: ${strukNomorMeja}
------------------------------
`;

        currentTransaction.items.forEach(item => {
            const itemTotal = item.price * item.quantity;
            textStruk += `${item.name} x${item.quantity} = Rp ${(itemTotal).toLocaleString('id-ID')}\n`;
        });

        textStruk += `
------------------------------
Total: Rp ${totalHarga}
Tunai: Rp ${bayarTunai}
Transfer: Rp ${bayarTransfer}
Kembalian: Rp ${kembalian}
------------------------------
Liburan Happy, Laper No Worry!
Thank you for your order!
We hope you like it.
Jangan lupa follow dan tag kami 
di media sosial
@y'umah kadek
`;

        // First try Web Share API
        if (navigator.share) {
            navigator.share({
                title: `Struk Pembayaran Meja ${strukNomorMeja}`,
                text: textStruk
            }).catch(() => {
                // If Web Share API fails, try Android intent
                if (window.Android && window.Android.shareText) {
                    window.Android.shareText(textStruk, `Struk Pembayaran Meja ${strukNomorMeja}`);
                } else {
                    fallbackShare(textStruk);
                }
            });
        } 
        // Then try Android intent if Web Share API not available
        else if (window.Android && window.Android.shareText) {
            window.Android.shareText(textStruk, `Struk Pembayaran Meja ${strukNomorMeja}`);
        } 
        // Fallback if neither is available
        else {
            fallbackShare(textStruk);
        }
    }
   function cetakStrukText(transaction) {
    if (!transaction) {
        alert('Tidak ada data transaksi untuk dicetak.');
        return;
    }

    const date = new Date(transaction.date);
    const strukTanggal = date.toLocaleDateString('id-ID');
    const strukWaktu = date.toLocaleTimeString('id-ID');
    const strukNomorMeja = transaction.nomorMeja;
    const totalHarga = transaction.totalHarga.toLocaleString('id-ID');
    const bayarTunai = transaction.tunai.toLocaleString('id-ID');
    const bayarTransfer = transaction.transfer.toLocaleString('id-ID');
    const kembalian = transaction.kembalian.toLocaleString('id-ID');

    let textStruk = `
Y'UMAH KADEK
Pandawa Beach Kutuh, Kuta Selatan, Badung-Bali
Tanggal: ${strukTanggal}
Waktu: ${strukWaktu}
No. Meja: ${strukNomorMeja}
------------------------------
`;
    transaction.items.forEach(item => {
        const itemTotal = item.price * item.quantity;
        textStruk += `${item.name} x${item.quantity} = Rp ${(itemTotal).toLocaleString('id-ID')}\n`;
    });

    textStruk += `
------------------------------
Total: Rp ${totalHarga}
Tunai: Rp ${bayarTunai}
Transfer: Rp ${bayarTransfer}
Kembalian: Rp ${kembalian}
------------------------------
Liburan Happy, Laper No Worry!
Thank you for your order!
We hope you like it.
Jangan lupa follow dan tag kami 
di media sosial
@y'umah kadek
`;
    
    const newWindow = window.open('', '', 'width=300,height=400');
    newWindow.document.open();
    newWindow.document.write('<pre>' + textStruk + '</pre>');
    newWindow.document.close();
    newWindow.print();
    newWindow.close();
}

    function fallbackShare(text) {
        // Create temporary element for copying
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                alert('Teks struk berhasil disalin ke clipboard!');
            } else {
                throw new Error('Copy failed');
            }
        } catch (err) {
            alert('Silakan salin teks struk secara manual:\n\n' + text);
        }
        
        document.body.removeChild(textarea);
    }

    // --- Laporan Keuangan ---
    document.getElementById('form-filter-laporan').addEventListener('submit', function(e) {
        e.preventDefault();
        renderLaporan();
    });

    let operationalCosts = JSON.parse(localStorage.getItem('operationalCosts')) || [];
    function saveOperationalCosts() {
        localStorage.setItem('operationalCosts', JSON.stringify(operationalCosts));
    }
    document.getElementById('form-biaya').addEventListener('submit', function(e) {
        e.preventDefault();
        const deskripsi = document.getElementById('deskripsi-biaya').value;
        const jumlah = parseInt(document.getElementById('jumlah-biaya').value);
        if (deskripsi && jumlah) {
            operationalCosts.push({
                id: `BC-${Date.now()}`,
                date: new Date().toISOString(),
                description: deskripsi,
                amount: jumlah
            });
            saveOperationalCosts();
            renderLaporan();
            this.reset();
        }
    });

    function deleteBiaya(biayaId) {
        if (confirm('Apakah Anda yakin ingin menghapus biaya ini?')) {
            operationalCosts = operationalCosts.filter(b => b.id !== biayaId);
            saveOperationalCosts();
            renderLaporan();
        }
    }
    
    function deletePendapatan(transactionId) {
        if (confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) {
            transactionHistory = transactionHistory.filter(t => t.id !== transactionId);
            saveTransactionHistory();
            renderLaporan();
        }
    }

    function showStrukFromReport(transactionId) {
        const transaction = transactionHistory.find(t => t.id === transactionId);
        if (transaction) {
            showStruk(transaction);
        } else {
            alert('Struk tidak ditemukan.');
        }
    }

    function renderLaporan() {
        const startDateInput = document.getElementById('tanggal-mulai').value;
        const endDateInput = document.getElementById('tanggal-selesai').value;

        const startDate = startDateInput ? new Date(startDateInput) : null;
        const endDate = endDateInput ? new Date(endDateInput) : null;
        if (endDate) {
            endDate.setDate(endDate.getDate() + 1); // Ensure end date is inclusive
        }

        const pendapatanList = document.getElementById('pendapatan-list');
        const biayaList = document.getElementById('biaya-list');

        pendapatanList.innerHTML = '';
        biayaList.innerHTML = '';

        let totalPendapatan = 0;
        let totalBiaya = 0;
        let labaBersihTunai = 0;
        let labaBersihTransfer = 0;

        const isAdmin = localStorage.getItem('currentUser') === 'admin';
        document.getElementById('th-aksi-pendapatan').style.display = isAdmin ? 'table-cell' : 'none';
        document.getElementById('th-aksi-biaya').style.display = isAdmin ? 'table-cell' : 'none';

        transactionHistory.filter(t => {
            const transactionDate = new Date(t.date);
            const isAfterStart = startDate ? transactionDate >= startDate : true;
            const isBeforeEnd = endDate ? transactionDate < endDate : true;
            return isAfterStart && isBeforeEnd;
        }).forEach(t => {
            totalPendapatan += t.totalHarga;
            labaBersihTunai += t.tunai;
            labaBersihTransfer += t.transfer;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${new Date(t.date).toLocaleDateString('id-ID')}</td>
                <td>${t.id}</td>
                <td>${t.nomorMeja}</td>
                <td>Rp ${t.totalHarga.toLocaleString('id-ID')}</td>
                <td>Rp ${t.tunai.toLocaleString('id-ID')}</td>
                <td>Rp ${t.transfer.toLocaleString('id-ID')}</td>
                <td class="non-printable" style="display: ${isAdmin ? 'table-cell' : 'none'};">
                    <div class="action-buttons">
                        <button class="btn btn-danger" onclick="deletePendapatan('${t.id}')">Hapus</button>
                    </div>
                </td>
                <td>
                    <button class="btn btn-primary" onclick="showStrukFromReport('${t.id}')">
                        <i class="fas fa-receipt"></i>
                    </button>
                </td>
            `;
            pendapatanList.appendChild(row);
        });

        operationalCosts.filter(c => {
            const costDate = new Date(c.date);
            const isAfterStart = startDate ? costDate >= startDate : true;
            const isBeforeEnd = endDate ? costDate < endDate : true;
            return isAfterStart && isBeforeEnd;
        }).forEach(cost => {
            totalBiaya += cost.amount;

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${new Date(cost.date).toLocaleDateString('id-ID')}</td>
                <td>${cost.description}</td>
                <td>Rp ${cost.amount.toLocaleString('id-ID')}</td>
                <td class="non-printable" style="display: ${isAdmin ? 'table-cell' : 'none'};">
                    <div class="action-buttons">
                        <button class="btn btn-danger" onclick="deleteBiaya('${cost.id}')">Hapus</button>
                    </div>
                </td>
            `;
            biayaList.appendChild(row);
        });

        const labaBersih = totalPendapatan - totalBiaya;

        document.getElementById('total-pendapatan').textContent = `Rp ${totalPendapatan.toLocaleString('id-ID')}`;
        document.getElementById('total-biaya').textContent = `Rp ${totalBiaya.toLocaleString('id-ID')}`;
        document.getElementById('laba-bersih').textContent = `Rp ${labaBersih.toLocaleString('id-ID')}`;
        document.getElementById('laba-bersih-tunai').textContent = `Rp ${labaBersihTunai.toLocaleString('id-ID')}`;
        document.getElementById('laba-bersih-transfer').textContent = `Rp ${labaBersihTransfer.toLocaleString('id-ID')}`;
        document.getElementById('total-pendapatan-cetak').textContent = `Rp ${totalPendapatan.toLocaleString('id-ID')}`;
        document.getElementById('total-biaya-cetak').textContent = `Rp ${totalBiaya.toLocaleString('id-ID')}`;
    }

    function downloadReportPdf(reportType) {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p', 'mm', 'a4');

    // Dapatkan referensi elemen yang akan disembunyikan
    const thAksiPendapatan = document.querySelector('#pendapatan-list').parentNode.querySelector('th:last-child');
    const tdAksiPendapatan = document.querySelectorAll('#pendapatan-list tr td:last-child');
    
    // Sembunyikan elemen-elemen tersebut secara sementara
    const originalThDisplay = thAksiPendapatan.style.display;
    thAksiPendapatan.style.display = 'none';
    tdAksiPendapatan.forEach(td => td.style.display = 'none');

    let reportContent, totalValue, reportTitle, filename;
    if (reportType === 'pendapatan') {
        reportContent = document.querySelector('#report-content .card:first-child').cloneNode(true);
        totalValue = document.getElementById('total-pendapatan-cetak').textContent;
        reportContent.querySelector('#total-pendapatan-cetak').textContent = totalValue;
        reportTitle = 'Laporan Pendapatan';
        filename = 'Laporan_Pendapatan';
    } else if (reportType === 'biaya') {
        reportContent = document.querySelector('#report-content .card:last-child').cloneNode(true);
        totalValue = document.getElementById('total-biaya-cetak').textContent;
        reportContent.querySelector('#total-biaya-cetak').textContent = totalValue;
        reportTitle = 'Laporan Biaya Operasional';
        filename = 'Laporan_Biaya_Operasional';
    } else {
        // Kembalikan tampilan elemen jika terjadi kesalahan
        thAksiPendapatan.style.display = originalThDisplay;
        tdAksiPendapatan.forEach(td => td.style.display = 'table-cell');
        console.error("Tipe laporan tidak valid.");
        return;
    }
    
    // Buat elemen header untuk PDF
    const startDate = document.getElementById('tanggal-mulai').value;
    const endDate = document.getElementById('tanggal-selesai').value;
    let periodeText = "Semua Tanggal";
    if (startDate && endDate) {
        const startFormatted = new Date(startDate).toLocaleDateString('id-ID');
        const endFormatted = new Date(endDate).toLocaleDateString('id-ID');
        periodeText = `${startFormatted} s/d ${endFormatted}`;
    } else if (startDate) {
        const startFormatted = new Date(startDate).toLocaleDateString('id-ID');
        periodeText = `Mulai ${startFormatted}`;
    } else if (endDate) {
        const endFormatted = new Date(endDate).toLocaleDateString('id-ID');
        periodeText = `Sampai ${endFormatted}`;
    }
    
    const headerElement = document.createElement('div');
    headerElement.innerHTML = `
        <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 15px;">
            <h3 style="margin: 0;">Y'UMAH KADEK</h3>
            <p style="margin: 0;">${reportTitle}<p>
            <p style="margin: 5px 0; color: #555;">Periode: ${periodeText}</p>
        </div>
    `;
    
    // Buat elemen sementara untuk menggabungkan header dan konten tabel
    const tempElement = document.createElement('div');
    tempElement.appendChild(headerElement);
    tempElement.appendChild(reportContent);
    tempElement.style.padding = '20px';
    
    // Sembunyikan tombol "non-printable" di dalam elemen sementara (yang ini sudah benar)
    tempElement.querySelectorAll('.non-printable').forEach(el => {
        el.style.display = 'none';
    });

    // Gunakan jspdf html() untuk mengonversi HTML ke PDF
    pdf.html(tempElement, {
        callback: function (pdf) {
            pdf.save(`${filename}_${new Date().toISOString().slice(0, 10)}.pdf`);
            
            // KEMBALIKAN TAMPILAN ELEMENT SETELAH PDF SELESAI DIBUAT
            thAksiPendapatan.style.display = originalThDisplay;
            tdAksiPendapatan.forEach(td => td.style.display = 'table-cell');
        },
        x: 15,
        y: 15,
        width: 175, // Lebar konten
        windowWidth: 650 // Lebar elemen yang akan dirender
    });
}

    function downloadStrukPdf(transactionId) {
        const transaction = transactionHistory.find(t => t.id === transactionId);
        if (!transaction) {
            alert('Transaksi tidak ditemukan!');
            return;
        }
        
        const strukHtml = generateStrukHTML(transaction);
        const tempContainer = document.createElement('div');
        tempContainer.innerHTML = strukHtml;
        tempContainer.style.width = '350px'; // Match the modal width for better rendering

        document.body.appendChild(tempContainer);

        html2canvas(tempContainer, { scale: 2, logging: true, useCORS: true }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: [canvas.width * 0.264583, canvas.height * 0.264583]
            });

            pdf.addImage(imgData, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
            pdf.save(`Struk_Transaksi_${transactionId}.pdf`);
            document.body.removeChild(tempContainer);
        }).catch(err => {
            console.error("Error generating PDF:", err);
            alert("Gagal membuat PDF. Silakan coba lagi.");
            document.body.removeChild(tempContainer);
        });
    }
    function cetakStruk() {
    window.print();
}
    // Fungsi untuk membagikan struk dari laporan
async function shareStrukLaporan(transactionId) {
    const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    const transaction = transactions.find(t => t.id === transactionId);

    if (!transaction) {
        alert('Struk tidak ditemukan.');
        return;
    }

    const strukContentDiv = document.getElementById('struk-content');
    if (!strukContentDiv) {
        alert('Elemen struk tidak ditemukan.');
        return;
    }

    const strukHTML = generateStrukContent(transaction);
    strukContentDiv.innerHTML = strukHTML;

    // Memastikan elemen modal struk ditampilkan
    document.getElementById('struk-modal').style.display = 'flex';

    try {
        const canvas = await html2canvas(strukContentDiv);
        const dataUrl = canvas.toDataURL('image/png');
        const blob = await (await fetch(dataUrl)).blob();
        const file = new File([blob], `struk_transaksi_${transaction.id}.png`, { type: 'image/png' });

        if (navigator.share) {
            await navigator.share({
                files: [file],
                title: `Struk Transaksi No. ${transaction.id}`,
                text: 'Berikut adalah struk transaksi Anda.'
            });
            console.log('Struk berhasil dibagikan');
        } else {
            alert('Fungsi berbagi tidak didukung di browser ini.');
        }
    } catch (err) {
        console.error('Error saat membagikan struk:', err);
        alert('Gagal membagikan struk. Coba lagi.');
    } finally {
        // Sembunyikan kembali modal setelah selesai
        closeStrukModal();
    }
}

    function generateStrukHTML(transaction) {
        const date = new Date(transaction.date);
        const strukTanggal = date.toLocaleDateString('id-ID');
        const strukWaktu = date.toLocaleTimeString('id-ID');
        
        let itemsHTML = '';
        transaction.items.forEach(item => {
            itemsHTML += `
                <tr>
                    <td colspan="2" style="text-align: left;">${item.name}</td>
                    <td class="item-qty">${item.quantity}</td>
                    <td class="item-price">Rp ${(item.price * item.quantity).toLocaleString('id-ID')}</td>
                </tr>
            `;
        });

        return `
            <div class="struk-content">
                <div class="struk-header">
                    <img id="struk-logo" src="Tanpa Judul.jpg" class="struk-logo" alt="Logo U'umah Kadek">
                    <h2>Y'umah kadek</h2>
                    <p>Pandawa Beach Kutuh, Kuta Selatan, Badung-Bali</p>
                </div>
                <p>Tanggal: ${strukTanggal}</p>
                <p>Waktu: ${strukWaktu}</p>
                <p>No. Meja: ${transaction.nomorMeja}</p>
                <hr>
                <table class="struk-items">
                    <thead>
                        <tr>
                            <th colspan="2" style="text-align: left;">Item</th>
                            <th class="item-qty">Qty</th>
                            <th class="item-price">Total</th>
                        </tr>
                    </thead>
                    <tbody>${itemsHTML}</tbody>
                </table>
                <div class="struk-total">
                    <p>Total: Rp ${transaction.totalHarga.toLocaleString('id-ID')}</p>
                    <p>Tunai: Rp ${transaction.tunai.toLocaleString('id-ID')}</p>
                    <p>Transfer: Rp ${transaction.transfer.toLocaleString('id-ID')}</p>
                    <p>Kembalian: Rp ${transaction.kembalian.toLocaleString('id-ID')}</p>
                </div>
                <hr>
                <p>Liburan Happy, Laper No Worry!</p>
<p>Thank you for your order!</p>
<p>We hope you like it.</p>
<p>Jangan lupa follow dan tag kami di media sosial</p>
<p>@y'umah kadek</p>
            </div>
        `;
    }
</script>
</body>

</html>
